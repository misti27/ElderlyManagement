
import { ActivityStatus } from '../model/Types';
import { MockData } from '../utils/MockData';
import promptAction from '@ohos.promptAction';

@Component
export struct HomePage {
  @State greeting: string = '';
  @State batteryLevel: number = 85;
  @State isCharging: boolean = false;
  @State currentActivity: ActivityStatus = ActivityStatus.WALKING;
  @State location: string = 'åŒ—äº¬å¸‚æœé˜³åŒºå¹¸ç¦å…»è€ç¤¾åŒº';

  aboutToAppear() {
    this.updateGreeting();
  }

  updateGreeting() {
    const hour = new Date().getHours();
    if (hour >= 5 && hour < 12) {
      this.greeting = 'æ—©ä¸Šå¥½';
    } else if (hour >= 12 && hour < 18) {
      this.greeting = 'ä¸‹åˆå¥½';
    } else {
      this.greeting = 'æ™šä¸Šå¥½';
    }
  }

  handleEmergencyCall() {
    // å®é™…å¼€å‘ä¸­ä¼šè°ƒç”¨ç³»ç»Ÿæ‹¨å·
    promptAction.showDialog({
      title: 'ç´§æ€¥å‘¼å«',
      message: 'æ­£åœ¨å‘¼å«ç´§æ€¥è”ç³»äºº (13900139000)...',
      buttons: [
        { text: 'å–æ¶ˆ', color: '#64748B' },
      ]
    });
  }

  build() {
    Column() {
      // å¤´éƒ¨ä¿¡æ¯å¡ç‰‡
      Column() {
        Row() {
          Column() {
            Text(this.greeting)
              .fontSize(24)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            Text(MockData.currentUser.name)
              .fontSize(18)
              .fontColor(Color.White)
              .opacity(0.9)
              .margin({ top: 4 })
          }
          .alignItems(HorizontalAlign.Start)

          Blank()

          // ç”µé‡æ˜¾ç¤º
          Row() {
            Text(`${this.batteryLevel}%`)
              .fontColor(Color.White)
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
            if (this.isCharging) {
              Text('âš¡')
                .fontColor('#FCD34D') // Amber
                .fontSize(16)
            }
          }
          .padding({ left: 12, right: 12, top: 6, bottom: 6 })
          .backgroundColor('rgba(255,255,255,0.2)')
          .borderRadius(20)
        }
        .width('100%')
        .padding(20)
      }
      .width('100%')
      .height(180)
      .backgroundColor('#2563EB') // Blue-600
      .borderRadius({ bottomLeft: 30, bottomRight: 30 })
      .justifyContent(FlexAlign.Start)
      .padding({ top: 40 })

      // å†…å®¹åŒºåŸŸ
      Column({ space: 20 }) {
        
        // çŠ¶æ€å¡ç‰‡
        Row() {
          Column() {
            Text('å½“å‰çŠ¶æ€')
              .fontSize(14)
              .fontColor('#64748B')
            Text(this.currentActivity)
              .fontSize(28)
              .fontWeight(FontWeight.Bold)
              .fontColor('#0F172A') // Slate-900
              .margin({ top: 8 })
          }
          .alignItems(HorizontalAlign.Start)
          .layoutWeight(1)

          // ç®€å•çš„å›¾æ ‡æ¨¡æ‹Ÿ
          Circle({ width: 50, height: 50 })
            .fill('#EFF6FF') // Blue-50
        }
        .width('100%')
        .padding(20)
        .backgroundColor(Color.White)
        .borderRadius(20)
        .shadow({ radius: 10, color: '#0A000000', offsetY: 4 })

        // ä½ç½®å¡ç‰‡
        Row() {
          Column() {
            Text('å½“å‰ä½ç½®')
              .fontSize(14)
              .fontColor('#64748B')
            Text(this.location)
              .fontSize(16)
              .fontColor('#334155') // Slate-700
              .margin({ top: 8 })
              .maxLines(2)
              .textOverflow({ overflow: TextOverflow.Ellipsis })
          }
          .alignItems(HorizontalAlign.Start)
          .layoutWeight(1)
          
          Text('ğŸ“')
            .fontSize(24)
        }
        .width('100%')
        .padding(20)
        .backgroundColor(Color.White)
        .borderRadius(20)
        .shadow({ radius: 10, color: '#0A000000', offsetY: 4 })

        Blank()

        // ç´§æ€¥å‘¼å«æŒ‰é’®
        Button() {
          Column() {
            Text('SOS')
              .fontSize(40)
              .fontWeight(FontWeight.Bold)
              .fontColor(Color.White)
            Text('ç´§æ€¥å‘¼å«')
              .fontSize(18)
              .fontColor(Color.White)
              .margin({ top: 5 })
          }
        }
        .type(ButtonType.Circle)
        .width(200)
        .height(200)
        .backgroundColor('#EF4444') // Red-500
        .shadow({ radius: 20, color: '#4DEF4444', offsetY: 10 })
        .onClick(() => {
          this.handleEmergencyCall();
        })
        .margin({ bottom: 40 })

      }
      .width('100%')
      .layoutWeight(1) // å æ®å‰©ä½™ç©ºé—´
      .padding(20)
      .margin({ top: -40 }) // å‘ä¸Šé‡å 
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F8FAFC')
  }
}
