
import { Guardian, User } from '../model/Types';
import { MockData } from '../utils/MockData';
import promptAction from '@ohos.promptAction';
import router from '@ohos.router';

@Component
export struct ProfilePage {
  @State currentUser: User = MockData.currentUser;
  @State guardians: Guardian[] = MockData.guardians;

  handleCall(phone: string) {
    promptAction.showDialog({
      title: 'æ‹¨æ‰“ç”µè¯',
      message: `ç¡®å®šæ‹¨æ‰“ ${phone} å—ï¼Ÿ`,
      buttons: [
        { text: 'å–æ¶ˆ', color: '#64748B' },
        { text: 'æ‹¨å«', color: '#2563EB' }
      ]
    });
  }

  handleLogout() {
    promptAction.showDialog({
      title: 'æç¤º',
      message: 'ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ',
      buttons: [
        { text: 'å–æ¶ˆ', color: '#64748B' },
        { text: 'é€€å‡º', color: '#EF4444' }
      ]
    }).then(result => {
      if (result.index === 1) {
        router.replaceUrl({ url: 'pages/LoginPage' });
      }
    });
  }

  build() {
    Scroll() {
      Column() {
        // ä¸ªäººä¿¡æ¯å¤´
        Row() {
          // å¤´åƒæ¨¡æ‹Ÿ (åœ†å½¢ + æ–‡å­—)
          Stack() {
            Circle({ width: 80, height: 80 })
              .fill('#DBEAFE') // Blue-100
            Text(this.currentUser.name.substring(0, 1))
              .fontSize(32)
              .fontWeight(FontWeight.Bold)
              .fontColor('#2563EB')
          }
          .margin({ right: 20 })

          Column() {
            Text(this.currentUser.name)
              .fontSize(24)
              .fontWeight(FontWeight.Bold)
              .fontColor('#0F172A')
            Text(`å¹´é¾„: ${this.currentUser.age}å²`)
              .fontSize(14)
              .fontColor('#64748B')
              .margin({ top: 4 })
            Text(this.currentUser.phone)
              .fontSize(14)
              .fontColor('#64748B')
              .margin({ top: 4 })
          }
          .alignItems(HorizontalAlign.Start)
        }
        .width('100%')
        .padding(24)
        .backgroundColor(Color.White)
        .margin({ bottom: 12 })

        // ç›‘æŠ¤äººç®¡ç†
        Column() {
          Row() {
            Text('æˆ‘çš„å®¶å±ž')
              .fontSize(16)
              .fontWeight(FontWeight.Bold)
              .fontColor('#0F172A')
            Blank()
            Text('æ·»åŠ ')
              .fontSize(14)
              .fontColor('#2563EB')
              .onClick(() => {
                promptAction.showToast({ message: 'è¯·åœ¨å­å¥³ç«¯æ·»åŠ å…³è”' });
              })
          }
          .width('100%')
          .padding({ left: 20, right: 20, top: 20, bottom: 10 })

          List() {
            ForEach(this.guardians, (item: Guardian) => {
              ListItem() {
                Row() {
                  // å¤´åƒ
                  Circle({ width: 40, height: 40 })
                    .fill('#F1F5F9')
                    .margin({ right: 12 })
                  
                  Column() {
                    Text(item.name)
                      .fontSize(16)
                      .fontColor('#0F172A')
                    Text(item.relation)
                      .fontSize(12)
                      .fontColor('#64748B')
                  }
                  .alignItems(HorizontalAlign.Start)
                  
                  Blank()
                  
                  Button('æ‹¨å·')
                    .height(32)
                    .fontSize(12)
                    .backgroundColor('#EFF6FF')
                    .fontColor('#2563EB')
                    .onClick(() => this.handleCall(item.phone))
                }
                .width('100%')
                .padding({ left: 20, right: 20, top: 12, bottom: 12 })
              }
            })
          }
          .divider({ strokeWidth: 1, color: '#F1F5F9', startMargin: 72 })
          .backgroundColor(Color.White)
        }
        .backgroundColor(Color.White)
        .margin({ bottom: 12 })

        // åŠŸèƒ½èœå•
        Column() {
          this.MenuItem('è®¾ç½®æé†’', 'ðŸ””')
          Divider().color('#F1F5F9').padding({ left: 50 })
          this.MenuItem('å¥åº·æ¡£æ¡ˆ', 'â¤ï¸')
          Divider().color('#F1F5F9').padding({ left: 50 })
          this.MenuItem('ä½¿ç”¨å¸®åŠ©', 'â“')
        }
        .backgroundColor(Color.White)
        .margin({ bottom: 20 })

        // é€€å‡ºæŒ‰é’®
        Button('é€€å‡ºç™»å½•')
          .width('90%')
          .height(50)
          .backgroundColor('#FEE2E2') // Red-100
          .fontColor('#EF4444') // Red-500
          .margin({ bottom: 40 })
          .onClick(() => this.handleLogout())
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#F8FAFC')
  }

  @Builder MenuItem(title: string, icon: string) {
    Row() {
      Text(icon)
        .fontSize(20)
        .width(30)
        .textAlign(TextAlign.Center)
        .margin({ right: 10 })
      Text(title)
        .fontSize(16)
        .fontColor('#0F172A')
      Blank()
      Text('>')
        .fontSize(14)
        .fontColor('#CBD5E1')
    }
    .width('100%')
    .padding(20)
    .backgroundColor(Color.White)
    .onClick(() => {
      promptAction.showToast({ message: `ç‚¹å‡»äº† ${title}` });
    })
  }
}
